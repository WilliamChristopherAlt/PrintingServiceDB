Trang In TÃ i Liá»‡u
1. ThÃ nh pháº§n giao diá»‡n
Progress Stepper (TrÃªn cÃ¹ng)
Hiá»ƒn thá»‹ 4 bÆ°á»›c: Upload â†’ Printer â†’ Settings â†’ Confirm
Highlight bÆ°á»›c hiá»‡n táº¡i
Hiá»ƒn thá»‹ "Step X of 4"
Step 1: Upload Document
TiÃªu Ä‘á»: "Select Document"
 MÃ´ táº£: "Upload a PDF or Word document to print"
VÃ¹ng kÃ©o-tháº£ file


Text: "Drag and drop your file here or click to browse"
Há»— trá»£ click Ä‘á»ƒ má»Ÿ file picker
Text hÆ°á»›ng dáº«n: "PDF or DOCX (up to 50 MB)"
Upload progress indicator


Progress bar hiá»ƒn thá»‹ % khi Ä‘ang upload
Estimated time remaining
"Uploading..." text
File info card (sau khi upload thÃ nh cÃ´ng):


TÃªn file
KÃ­ch thÆ°á»›c
Sá»‘ trang
Icon loáº¡i file
NÃºt "Remove" Ä‘á»ƒ xÃ³a vÃ  chá»n láº¡i
Text thÃ´ng tin: "Allowed file types: PDF, DOCX. Maximum file size: 50 MB."


Text lÆ°u trá»¯: "Files are stored securely and will be deleted after printing."


NÃºt "Continue to Printer Selection" (enabled sau khi upload thÃ nh cÃ´ng)


Step 2: Printer Selection
TiÃªu Ä‘á»: "Select Printer"
 MÃ´ táº£: "Choose an available printer"
Bá»™ lá»c vá»‹ trÃ­:


Dropdown "Campus"
Dropdown "Building" (cáº­p nháº­t theo Campus)
Dropdown "Room" (cáº­p nháº­t theo Building)
Danh sÃ¡ch mÃ¡y in (dáº¡ng card):


TÃªn mÃ¡y in
Vá»‹ trÃ­ Ä‘áº§y Ä‘á»§ (Campus - Building - Room)
Status badge:
"Available" (mÃ u xanh)
"Busy" (mÃ u vÃ ng)
"Offline" (mÃ u xÃ¡m)
Icon tráº¡ng thÃ¡i
ThÃ´ng tin há»— trá»£ (A4, A3, Color, Duplex icons)
Queue info: "X jobs ahead" (náº¿u Busy)
Empty state (khi khÃ´ng cÃ³ mÃ¡y in):


Icon mÃ¡y in vá»›i dáº¥u X
Text: "No printers available at this location"
Suggestion: "Try selecting a different location"
NÃºt "Back" vÃ  "Continue to Settings"


Step 3: Print Settings
TiÃªu Ä‘á»: "Configure Print Settings"
 MÃ´ táº£: "Customize your print job"
Form cáº¥u hÃ¬nh:

 Paper Size: Dropdown


A3
A4 (default)
A5
Page Range:


Radio "All pages" (default)
Radio "Custom" vá»›i input field
Placeholder: "e.g., 1-5, 8, 10-12"
Helper text: "Enter page numbers and ranges separated by commas"
Orientation: Radio buttons


Portrait (default)
Landscape
Sides: Radio buttons


One-sided (default)
Two-sided (Duplex)
Color Mode: Dropdown


Color
Grayscale
Black & White (default)
Copies: Number input vá»›i nÃºt +/-


Min: 1, Max: 99
Default: 1
Preview area:


Thumbnail cá»§a trang Ä‘áº§u tiÃªn
Text: "Preview updates based on your settings"
Hiá»ƒn thá»‹ orientation vÃ  paper size
Page Balance Summary card:


"Current Balance: [X] A4 pages"
"Pages to Print: [Y] A4 equivalent"
"Remaining After Print: [Z] A4 pages"
Warning state (khi khÃ´ng Ä‘á»§ sá»‘ dÆ°):
Text mÃ u Ä‘á»: "Insufficient balance"
Required: [Y] pages
Available: [X] pages
Need: [Y-X] more pages
NÃºt "Buy More Pages"
NÃºt "Back" vÃ  "Continue to Confirm" (disabled náº¿u khÃ´ng Ä‘á»§ sá»‘ dÆ°)


Step 4: Confirmation
TiÃªu Ä‘á»: "Review & Confirm"
 MÃ´ táº£: "Please review your print job before submitting"
Summary sections:

 Document Info:


File name
File size
Total pages in document
Printer Info:


Printer name
Location (Campus - Building - Room)
Current status
Print Settings:


Paper size
Page range (e.g., "Pages 1-5, 8, 10-12" or "All pages")
Orientation
Sides
Color mode
Number of copies
Page Balance:


Pages to print (A4 equivalent)
Current balance
Remaining balance after print
NÃºt "Back to Edit", "Cancel", vÃ  "Submit Print Job"


Success Modal (Sau khi submit)
Icon thÃ nh cÃ´ng (âœ“)
ThÃ´ng Ä‘iá»‡p: "Print Job Submitted Successfully!"
Job ID: Display mÃ£ job (e.g., "JOB-123456")
ThÃ´ng tin:
Printer location
Estimated completion time
Pages printed
Balance remaining
NÃºt "View Print History" vÃ  "Print Another Document"
Loading States
Upload spinner: "Uploading file... [X%]"
Submit spinner: "Submitting print job..."
Printer status check: "Checking printer availability..."
Error Displays
Network error banner:


Icon: âš ï¸
Text: "Connection failed. Please try again."
NÃºt "Retry"
Upload error banner:


Icon: âŒ
Text: [Error message]
NÃºt "Try Again"
Printer offline notification:


Icon: ğŸ”´
Text: "Selected printer is no longer available"
Suggestion: "Please select another printer"
NÃºt "Back to Printer Selection"

2. Flow tÆ°Æ¡ng tÃ¡c
2.1 Upload tÃ i liá»‡u (Step 1)
NgÆ°á»i dÃ¹ng truy cáº­p trang in tÃ i liá»‡u
Hiá»ƒn thá»‹ vÃ¹ng kÃ©o-tháº£ file vá»›i text hÆ°á»›ng dáº«n
NgÆ°á»i dÃ¹ng click vÃ o vÃ¹ng upload hoáº·c kÃ©o-tháº£ file
Hiá»ƒn thá»‹ file picker (náº¿u click)
NgÆ°á»i dÃ¹ng chá»n file
Hiá»ƒn thá»‹ upload progress bar vá»›i %
Náº¿u file há»£p lá»‡:
Upload progress bar Ä‘áº¡t 100%
Hiá»ƒn thá»‹ file info card
Hiá»ƒn thá»‹: tÃªn file, kÃ­ch thÆ°á»›c, sá»‘ trang, icon loáº¡i file
NÃºt "Continue" chuyá»ƒn tá»« disabled sang enabled
Náº¿u file khÃ´ng há»£p lá»‡:
Hiá»ƒn thá»‹ error banner mÃ u Ä‘á»
Text lá»—i cá»¥ thá»ƒ (sai Ä‘á»‹nh dáº¡ng / quÃ¡ lá»›n)
KhÃ´ng cho phÃ©p continue
NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ click "Remove" Ä‘á»ƒ xÃ³a file
XÃ³a file info card
Reset vá» tráº¡ng thÃ¡i ban Ä‘áº§u (vÃ¹ng kÃ©o-tháº£)
NÃºt "Continue" trá»Ÿ láº¡i disabled
NgÆ°á»i dÃ¹ng click "Continue to Printer Selection"
Chuyá»ƒn sang Step 2
Progress stepper highlight Step 2
2.2 Chá»n mÃ¡y in (Step 2)
Hiá»ƒn thá»‹ bá»™ lá»c vá»‹ trÃ­ (Campus, Building, Room)
Hiá»ƒn thá»‹ danh sÃ¡ch mÃ¡y in vá»›i status badges
NgÆ°á»i dÃ¹ng chá»n Campus tá»« dropdown
Danh sÃ¡ch Building Ä‘Æ°á»£c cáº­p nháº­t theo Campus
Room dropdown bá»‹ reset
NgÆ°á»i dÃ¹ng chá»n Building
Danh sÃ¡ch Room Ä‘Æ°á»£c cáº­p nháº­t theo Building
NgÆ°á»i dÃ¹ng chá»n Room
Danh sÃ¡ch mÃ¡y in Ä‘Æ°á»£c lá»c theo vá»‹ trÃ­ Ä‘Ã£ chá»n
Náº¿u khÃ´ng cÃ³ mÃ¡y in:
Hiá»ƒn thá»‹ empty state vá»›i icon vÃ  text
Suggestion: chá»n vá»‹ trÃ­ khÃ¡c
NÃºt "Continue" disabled
NgÆ°á»i dÃ¹ng click chá»n má»™t mÃ¡y in
Card mÃ¡y in Ä‘Æ°á»£c highlight (border mÃ u xanh)
Hiá»ƒn thá»‹ status: Available/Busy/Offline
Hiá»ƒn thá»‹ thÃ´ng tin há»— trá»£ (A4, A3, Color icons)
Náº¿u Busy: hiá»ƒn thá»‹ "X jobs ahead"
Náº¿u mÃ¡y in Offline: khÃ´ng cho phÃ©p chá»n (card mÃ u xÃ¡m, disabled)
NÃºt "Continue" chuyá»ƒn tá»« disabled sang enabled
NgÆ°á»i dÃ¹ng click "Back"
Quay láº¡i Step 1
Progress stepper highlight Step 1
Giá»¯ nguyÃªn file Ä‘Ã£ upload
NgÆ°á»i dÃ¹ng click "Continue to Settings"
Chuyá»ƒn sang Step 3
Progress stepper highlight Step 3
2.3 Cáº¥u hÃ¬nh in (Step 3)
Hiá»ƒn thá»‹ form cáº¥u hÃ¬nh vá»›i cÃ¡c giÃ¡ trá»‹ default
Hiá»ƒn thá»‹ preview thumbnail cá»§a trang Ä‘áº§u
Hiá»ƒn thá»‹ Page Balance Summary card vá»›i sá»‘ dÆ° hiá»‡n táº¡i
NgÆ°á»i dÃ¹ng chá»n Paper Size tá»« dropdown
Preview cáº­p nháº­t kÃ­ch thÆ°á»›c
Page Balance Summary cáº­p nháº­t "Pages to Print"
Recalculate A4 equivalent
NgÆ°á»i dÃ¹ng chá»n Page Range
Náº¿u chá»n "All":
Input custom bá»‹ disabled vÃ  clear
TÃ­nh táº¥t cáº£ trang trong tÃ i liá»‡u
Náº¿u chá»n "Custom":
Input custom Ä‘Æ°á»£c enabled
Placeholder: "e.g., 1-5, 8, 10-12"
Helper text hiá»ƒn thá»‹
NgÆ°á»i dÃ¹ng nháº­p page range custom
Validate format trong khi nháº­p
Náº¿u format sai:
Input border mÃ u Ä‘á»
Error text: "Invalid format. Use: 1-5, 8, 10-12"
Náº¿u page number vÆ°á»£t quÃ¡ tÃ i liá»‡u:
Error text: "Page number exceeds document length"
NgÆ°á»i dÃ¹ng chá»n Orientation
Preview xoay theo hÆ°á»›ng (Portrait/Landscape)
NgÆ°á»i dÃ¹ng chá»n Sides
Recalculate pages to print (two-sided = Â½ sheets)
Page Balance Summary cáº­p nháº­t
NgÆ°á»i dÃ¹ng chá»n Color Mode
Preview thay Ä‘á»•i mÃ u sáº¯c tÆ°Æ¡ng á»©ng
NgÆ°á»i dÃ¹ng thay Ä‘á»•i Copies
DÃ¹ng nÃºt +/- hoáº·c nháº­p trá»±c tiáº¿p
Validate: min=1, max=99
Recalculate total pages to print
Page Balance Summary cáº­p nháº­t real-time
Page Balance Summary tá»± Ä‘á»™ng cáº­p nháº­t:
"Pages to Print: [Y] A4 equivalent"
"Remaining After Print: [Current - Y]"
Náº¿u khÃ´ng Ä‘á»§ sá»‘ dÆ°:
Text mÃ u Ä‘á»: "Insufficient balance"
Hiá»ƒn thá»‹ "Required: [Y] | Available: [X] | Need: [Y-X] more"
NÃºt "Buy More Pages" xuáº¥t hiá»‡n
NÃºt "Continue" bá»‹ disabled
Náº¿u Ä‘á»§ sá»‘ dÆ°:
Text mÃ u xanh
NÃºt "Continue" enabled
NgÆ°á»i dÃ¹ng click "Back"
Quay láº¡i Step 2
Progress stepper highlight Step 2
Giá»¯ nguyÃªn settings Ä‘Ã£ chá»n
NgÆ°á»i dÃ¹ng click "Buy More Pages" (náº¿u khÃ´ng Ä‘á»§)
Má»Ÿ trang mua trang trong tab má»›i
Giá»¯ nguyÃªn trang in hiá»‡n táº¡i
NgÆ°á»i dÃ¹ng click "Continue to Confirm"
Chuyá»ƒn sang Step 4
Progress stepper highlight Step 4
2.4 XÃ¡c nháº­n vÃ  gá»­i (Step 4)
Hiá»ƒn thá»‹ summary Ä‘áº§y Ä‘á»§ trong cÃ¡c sections
Hiá»ƒn thá»‹ táº¥t cáº£ thÃ´ng tin Ä‘Ã£ chá»n (read-only)
NgÆ°á»i dÃ¹ng review thÃ´ng tin
NgÆ°á»i dÃ¹ng click "Back to Edit"
Quay láº¡i Step 3
Progress stepper highlight Step 3
Giá»¯ nguyÃªn toÃ n bá»™ thÃ´ng tin Ä‘Ã£ cáº¥u hÃ¬nh
NgÆ°á»i dÃ¹ng click "Cancel"
Hiá»ƒn thá»‹ confirm dialog: "Are you sure you want to cancel?"
Náº¿u confirm:
ÄÃ³ng trang in
Quay vá» dashboard
KhÃ´ng lÆ°u gÃ¬
Náº¿u khÃ´ng confirm:
ÄÃ³ng dialog
á» láº¡i Step 4
NgÆ°á»i dÃ¹ng click "Submit Print Job"
NÃºt "Submit" chuyá»ƒn sang disabled
Hiá»ƒn thá»‹ loading spinner: "Submitting print job..."
Submit button text: "Submitting..."
Náº¿u submit thÃ nh cÃ´ng:
ÄÃ³ng trang print
Hiá»ƒn thá»‹ success modal
Hiá»ƒn thá»‹ Job ID (e.g., "JOB-123456")
Hiá»ƒn thá»‹ thÃ´ng tin: printer location, estimated time, pages printed, balance remaining
Náº¿u submit tháº¥t báº¡i:
Hiá»ƒn thá»‹ error banner
Text lá»—i cá»¥ thá»ƒ
NÃºt "Submit" quay láº¡i enabled
NÃºt "Retry" xuáº¥t hiá»‡n
NgÆ°á»i dÃ¹ng click "View Print History" (trong success modal)
ÄÃ³ng modal
Chuyá»ƒn Ä‘áº¿n trang lá»‹ch sá»­ in
NgÆ°á»i dÃ¹ng click "Print Another Document" (trong success modal)
ÄÃ³ng modal
Reset form vá» Step 1 (tráº¡ng thÃ¡i ban Ä‘áº§u)
Clear táº¥t cáº£ dá»¯ liá»‡u Ä‘Ã£ nháº­p
2.5 Xá»­ lÃ½ lá»—i vÃ  edge cases
Upload file sai Ä‘á»‹nh dáº¡ng:
Hiá»ƒn thá»‹ error banner mÃ u Ä‘á»
Icon: âŒ
Text: "Invalid file type. Please upload PDF or DOCX."
KhÃ´ng cho phÃ©p continue
NÃºt "Try Again" Ä‘á»ƒ chá»n file khÃ¡c
Upload file quÃ¡ lá»›n:
Hiá»ƒn thá»‹ error banner mÃ u Ä‘á»
Text: "File size exceeds 50 MB limit."
Hiá»ƒn thá»‹ kÃ­ch thÆ°á»›c file: "Your file: [X] MB"
KhÃ´ng cho phÃ©p continue
Network error khi upload:
Upload progress bar dá»«ng láº¡i
Hiá»ƒn thá»‹ error banner: "Upload failed. Connection error."
NÃºt "Retry Upload"
Giá»¯ nguyÃªn file Ä‘Ã£ chá»n Ä‘á»ƒ retry
KhÃ´ng cÃ³ mÃ¡y in available:
Hiá»ƒn thá»‹ empty state vá»›i icon
Text: "No printers available at this location."
Suggestion: "Try selecting a different location"
NÃºt "Continue" disabled
KhÃ´ng Ä‘á»§ sá»‘ dÆ° táº¡i Step 3:
Page Balance Summary hiá»ƒn thá»‹ warning mÃ u Ä‘á»
Text: "Insufficient balance"
Breakdown: Required vs Available
NÃºt "Buy More Pages" xuáº¥t hiá»‡n
NÃºt "Continue" disabled
KhÃ´ng Ä‘á»§ sá»‘ dÆ° táº¡i Step 4 (double-check):
Khi click Submit, kiá»ƒm tra láº¡i sá»‘ dÆ°
Náº¿u khÃ´ng Ä‘á»§ (sá»‘ dÆ° Ä‘Ã£ thay Ä‘á»•i):
Hiá»ƒn thá»‹ error banner
Text: "Balance insufficient. Your balance may have changed."
NÃºt "Back to Settings" Ä‘á»ƒ review
KhÃ´ng submit job
MÃ¡y in offline khi submit:
Hiá»ƒn thá»‹ error modal
Icon: ğŸ”´
Text: "Selected printer is no longer available."
Suggestion: "Please select another printer."
NÃºt "Back to Printer Selection"
KhÃ´ng trá»« sá»‘ dÆ°
Network error khi submit:
Hiá»ƒn thá»‹ error banner
Text: "Connection failed. Please try again."
NÃºt "Retry"
NÃºt "Submit" quay láº¡i enabled
KhÃ´ng trá»« sá»‘ dÆ° cho Ä‘áº¿n khi submit thÃ nh cÃ´ng
Session timeout:
Hiá»ƒn thÃ¬ notification: "Session expired. Please log in again."
Redirect vá» trang login
(Optional) LÆ°u draft Ä‘á»ƒ recover sau khi login

3. Use Case
Danh sÃ¡ch cÃ¡c usecase
Use Case Index
TÃªn Use Case
MoSCoW
SV-4-1
In tÃ i liá»‡u
Must Have


Má»¥c
Ná»™i dung
Usecase ID
SV-4-1
TÃªn
In tÃ i liá»‡u
MÃ´ táº£
Sinh viÃªn upload tÃ i liá»‡u, chá»n mÃ¡y in, cáº¥u hÃ¬nh thÃ´ng sá»‘ in vÃ  gá»­i lá»‡nh in
Actor
Sinh viÃªn
Trigger
Sinh viÃªn click "Upload & Print Document" tá»« dashboard hoáº·c truy cáº­p trá»±c tiáº¿p trang in
Quy Ä‘á»‹nh nghiá»‡p vá»¥
Há»‡ thá»‘ng chá»‰ cháº¥p nháº­n nhá»¯ng file cÃ³ máº·t trong báº£ng permitted_file_type vÃ  cÃ³ is_permitted = 1 (hiá»‡n há»— trá»£ PDF, DOCX).
Dung lÆ°á»£ng file upload tá»‘i Ä‘a 50MB.
Má»—i lÆ°á»£t in cho phÃ©p tá»‘i Ä‘a 99 copies.
File sau khi upload sáº½ Ä‘Æ°á»£c lÆ°u trÃªn Supabase Storage, vÃ  database chá»‰ lÆ°u file_name.
Page range pháº£i nháº­p Ä‘Ãºng Ä‘á»‹nh dáº¡ng "1-5, 8, 10-12". Backend sáº½ parse vÃ  táº¡o record tÆ°Æ¡ng á»©ng trong print_job_page.
TÃ¹y chá»n two-sided lÃ m giáº£m sá»‘ trang thÃ nh má»™t ná»­a
Tráº¡ng thÃ¡i lá»‡nh in Ä‘i theo flow: queued â†’ printing â†’ completed / failed / cancelled.
TrÆ°á»›c khi submit, há»‡ thá»‘ng kiá»ƒm tra sá»‘ dÆ° real-time tá»« student_page_purchase vÃ  print_job Ä‘á»ƒ Ä‘áº£m báº£o sinh viÃªn Ä‘á»§ tiá»n.


Main Flow
BÆ°á»›c 1: Upload tÃ i liá»‡u
1. Sinh viÃªn truy cáº­p trang in tÃ i liá»‡u
2. Sinh viÃªn click hoáº·c kÃ©o-tháº£ file vÃ o vÃ¹ng upload
3. Há»‡ thá»‘ng hiá»ƒn thá»‹ file picker (náº¿u click)
4. Sinh viÃªn chá»n file (PDF hoáº·c DOCX)
5. Há»‡ thá»‘ng validate file:
  - Kiá»ƒm tra Ä‘á»‹nh dáº¡ng trong báº£ng permitted_file_type (is_permitted = 1)
  - Kiá»ƒm tra kÃ­ch thÆ°á»›c â‰¤ 50MB
6. Náº¿u há»£p lá»‡:
  - Upload file lÃªn Supabase Storage
  - Hiá»ƒn thá»‹ upload progress (%)
  - Extract metadata: tÃªn file, kÃ­ch thÆ°á»›c, sá»‘ trang
  - Hiá»ƒn thá»‹ file info card
  - Enable nÃºt "Continue"
7. Náº¿u khÃ´ng há»£p lá»‡:
  - Hiá»ƒn thá»‹ error message cá»¥ thá»ƒ
  - KhÃ´ng upload
  - Disable nÃºt "Continue"
8. Sinh viÃªn click "Continue to Printer Selection"

BÆ°á»›c 2: Chá»n mÃ¡y in
9. Há»‡ thá»‘ng truy váº¥n danh sÃ¡ch mÃ¡y in tá»« printer_physical JOIN vá»›i printer_model, brand, room, building WHERE is_enabled = 1
10. Hiá»ƒn thá»‹ danh sÃ¡ch mÃ¡y in vá»›i: tÃªn (model_name), vá»‹ trÃ­ (campus_name, building_code, room_code), status, thÃ´ng tin há»— trá»£
11. Sinh viÃªn lá»c theo vá»‹ trÃ­ (Campus â†’ Building â†’ Room)
12. Há»‡ thá»‘ng lá»c danh sÃ¡ch theo Ä‘iá»u kiá»‡n Ä‘Æ°á»£c chá»n
13. Sinh viÃªn chá»n má»™t mÃ¡y in
14. Há»‡ thá»‘ng kiá»ƒm tra mÃ¡y in cÃ³ is_enabled = 1 vÃ  khÃ´ng offline
15. Náº¿u kháº£ dá»¥ng:
  â€¢ LÃ m ná»•i báº­t mÃ¡y in Ä‘Ã£ chá»n
  â€¢ KÃ­ch hoáº¡t nÃºt "Continue"
16. Náº¿u offline: khÃ´ng cho phÃ©p chá»n, hiá»ƒn thá»‹ "Printer offline"
17. Sinh viÃªn nháº¥n "Continue to Settings"

BÆ°á»›c 3: Cáº¥u hÃ¬nh in
18. Há»‡ thá»‘ng táº£i thÃ´ng tin mÃ¡y in Ä‘Ã£ chá»n Ä‘á»ƒ kiá»ƒm tra settings
19. Hiá»ƒn thá»‹ form vá»›i giÃ¡ trá»‹ máº·c Ä‘á»‹nh:
  â€¢ Paper size: A4 (tra page_size_id tá»« báº£ng page_size)
  â€¢ Page range: All
  â€¢ Orientation: Portrait
  â€¢ Sides: One-sided
  â€¢ Color mode: Black & White
  â€¢ Copies: 1
20. Há»‡ thá»‘ng tÃ­nh sá»‘ dÆ° hiá»‡n táº¡i:
  â€¢ Tá»•ng A4 equivalent Ä‘Ã£ mua tá»« student_page_purchase WHERE payment_status = 'completed'
  â€¢ Tá»•ng A4 equivalent Ä‘Ã£ in tá»« print_job JOIN print_job_page WHERE print_status = 'completed'
  â€¢ Sá»‘ dÆ° = ÄÃ£ mua - ÄÃ£ in
21. Sinh viÃªn thay Ä‘á»•i settings
22. Má»—i khi thay Ä‘á»•i:
  â€¢ Há»‡ thá»‘ng phÃ¢n tÃ­ch page range (náº¿u custom) hoáº·c dÃ¹ng total pages (náº¿u all)
  â€¢ Ãp dá»¥ng A4 conversion tá»« page_size
  â€¢ NhÃ¢n vá»›i number_of_copy
  â€¢ So sÃ¡nh vá»›i sá»‘ dÆ°
23. Náº¿u Ä‘á»§ sá»‘ dÆ°:
  â€¢ Hiá»ƒn thá»‹ "Pages to Print: [Y]"
  â€¢ Hiá»ƒn thá»‹ "Remaining: [sá»‘ dÆ° - Y]"
  â€¢ KÃ­ch hoáº¡t nÃºt "Continue"
24. Náº¿u khÃ´ng Ä‘á»§:
  â€¢ Hiá»ƒn thá»‹ warning mÃ u Ä‘á»: "Insufficient balance"
  â€¢ Hiá»ƒn thá»‹ breakdown (Required vs Available)
  â€¢ VÃ´ hiá»‡u hÃ³a nÃºt "Continue"
  â€¢ Hiá»ƒn thá»‹ nÃºt "Buy More Pages"
25. Sinh viÃªn nháº¥n "Continue to Confirm"

BÆ°á»›c 4: XÃ¡c nháº­n vÃ  submit
26. Há»‡ thá»‘ng hiá»ƒn thá»‹ summary:
  â€¢ Document info (file name, size, total pages)
  â€¢ Printer info (name, location)
  â€¢ Print settings (táº¥t cáº£ cáº¥u hÃ¬nh)
  â€¢ Page balance (pages to print, current balance, remaining)
27. Sinh viÃªn xem xÃ©t thÃ´ng tin
28. Sinh viÃªn nháº¥n "Submit Print Job"
29. Há»‡ thá»‘ng kiá»ƒm tra láº¡i sá»‘ dÆ°:
  â€¢ Query láº¡i sá»‘ dÆ° hiá»‡n táº¡i
  â€¢ So sÃ¡nh vá»›i pages to print
  â€¢ Náº¿u khÃ´ng Ä‘á»§: há»§y bá» vÃ  hiá»ƒn thá»‹ error
30. Há»‡ thá»‘ng kiá»ƒm tra mÃ¡y in váº«n kháº£ dá»¥ng:
  â€¢ XÃ¡c minh is_enabled = 1
  â€¢ Kiá»ƒm tra status khÃ´ng offline
  â€¢ Náº¿u offline: há»§y bá» vÃ  hiá»ƒn thá»‹ error
31. Náº¿u táº¥t cáº£ kiá»ƒm tra Ä‘á»u pass, há»‡ thá»‘ng táº¡o record trong print_job:
  â€¢ job_id: NEWID()
  â€¢ student_id: tá»« session
  â€¢ printer_id: mÃ¡y in Ä‘Ã£ chá»n
  â€¢ file_name: tÃªn file (Supabase path)
  â€¢ file_type: PDF/DOCX
  â€¢ file_size_kb: kÃ­ch thÆ°á»›c
  â€¢ paper_size_id: lookup tá»« page_size
  â€¢ page_orientation: portrait/landscape
  â€¢ print_side: one-sided/double-sided
  â€¢ color_mode: color/grayscale/black-white
  â€¢ number_of_copy: sá»‘ copies
  â€¢ print_status: 'queued'
  â€¢ start_time: NULL
  â€¢ end_time: NULL
  â€¢ created_at: GETDATE()
32. Há»‡ thá»‘ng phÃ¢n tÃ­ch page range vÃ  táº¡o records trong print_job_page:
  â€¢ Vá»›i má»—i trang trong range: INSERT INTO print_job_page (job_id, page_number)
33. Há»‡ thá»‘ng ghi log vÃ o system_audit_log:
  â€¢ action_type: 'print_job_created'
  â€¢ table_name: 'print_job'
  â€¢ record_id: job_id má»›i táº¡o
34. Há»‡ thá»‘ng gá»­i lá»‡nh in Ä‘áº¿n mÃ¡y in (qua print queue/service)
35. Há»‡ thá»‘ng tráº£ vá» job_id
36. Hiá»ƒn thá»‹ success modal vá»›i: Job ID, Printer location, Estimated completion time, Pages printed, Remaining balance

Background process:
37. Printer service nháº­n job vÃ  báº¯t Ä‘áº§u in
38. Cáº­p nháº­t print_status: 'queued' â†’ 'printing', start_time: GETDATE()
39. Khi in xong: cáº­p nháº­t print_status: 'completed', end_time: GETDATE()
Alternative Flow
Alt 1: Sinh viÃªn quay láº¡i bÆ°á»›c trÆ°á»›c
â€¢ Táº¡i báº¥t ká»³ bÆ°á»›c nÃ o (2, 3, 4), sinh viÃªn nháº¥n "Back"
â€¢ Há»‡ thá»‘ng quay vá» bÆ°á»›c trÆ°á»›c
â€¢ Giá»¯ nguyÃªn táº¥t cáº£ dá»¯ liá»‡u Ä‘Ã£ nháº­p
â€¢ Progress stepper cáº­p nháº­t highlight
Alt 2: Sinh viÃªn xÃ³a file vÃ  chá»n láº¡i
â€¢ Táº¡i BÆ°á»›c 1, sau khi táº£i lÃªn file, sinh viÃªn nháº¥n "Remove"
â€¢ Há»‡ thá»‘ng xÃ³a file khá»i Supabase Storage
â€¢ Reset vá» tráº¡ng thÃ¡i ban Ä‘áº§u
â€¢ VÃ´ hiá»‡u hÃ³a nÃºt "Continue"
Alt 3: Sinh viÃªn há»§y job
â€¢ Táº¡i báº¥t ká»³ bÆ°á»›c nÃ o, sinh viÃªn nháº¥n "Cancel"
â€¢ Hiá»ƒn thá»‹ confirm dialog: "Are you sure you want to cancel?"
â€¢ Náº¿u xÃ¡c nháº­n:
  - XÃ³a file táº¡m khá»i Supabase Storage
  - ÄÃ³ng trang in
  - Chuyá»ƒn hÆ°á»›ng vá» dashboard
  - KhÃ´ng táº¡o print job
â€¢ Náº¿u khÃ´ng xÃ¡c nháº­n: Ä‘Ã³ng dialog, á»Ÿ láº¡i bÆ°á»›c hiá»‡n táº¡i
Alt 4: Sinh viÃªn mua thÃªm trang khi khÃ´ng Ä‘á»§
â€¢ Táº¡i BÆ°á»›c 3, khi khÃ´ng Ä‘á»§ sá»‘ dÆ°, sinh viÃªn nháº¥n "Buy More Pages"
â€¢ Má»Ÿ trang mua trang trong tab/window má»›i
â€¢ Giá»¯ nguyÃªn tab hiá»‡n táº¡i vá»›i táº¥t cáº£ thÃ´ng tin Ä‘Ã£ nháº­p
â€¢ Sau khi mua xong, sinh viÃªn quay láº¡i tab in
â€¢ Há»‡ thá»‘ng tá»± Ä‘á»™ng lÃ m má»›i sá»‘ dÆ°
â€¢ Kiá»ƒm tra láº¡i sá»‘ dÆ°, náº¿u Ä‘á»§: kÃ­ch hoáº¡t nÃºt "Continue"
Exception Flow
Exc 1: File khÃ´ng há»£p lá»‡
â€¢ Táº¡i BÆ°á»›c 1, bÆ°á»›c 5: kiá»ƒm tra file
â€¢ File khÃ´ng pháº£i PDF/DOCX hoáº·c > 50MB
â€¢ Xá»­ lÃ½:
  - KhÃ´ng táº£i lÃªn file
  - Hiá»ƒn thá»‹ error banner vá»›i lÃ½ do cá»¥ thá»ƒ
  - VÃ´ hiá»‡u hÃ³a nÃºt "Continue"
  - NgÆ°á»i dÃ¹ng pháº£i chá»n file khÃ¡c

Exc 2: Page range khÃ´ng há»£p lá»‡
â€¢ Format sai (vÃ­ dá»¥: "1-5-8", "abc", "1,,5"):
  - Kiá»ƒm tra format: chá»‰ sá»‘, dáº¥u pháº©y, dáº¥u gáº¡ch ngang
  - Hiá»ƒn thá»‹ error: "Invalid page range format. Use: 1-5, 8, 10-12"
  - Input border mÃ u Ä‘á»
  - VÃ´ hiá»‡u hÃ³a nÃºt "Continue"
â€¢ Sá»‘ trang vÆ°á»£t quÃ¡ tÃ i liá»‡u (vÃ­ dá»¥: "1-100" nhÆ°ng chá»‰ cÃ³ 50 trang):
  - Kiá»ƒm tra: phÃ¢n tÃ­ch range vÃ  kiá»ƒm tra max page â‰¤ total pages
  - Hiá»ƒn thá»‹ error: "Page number exceeds document length (max: 50)"
  - Input border mÃ u Ä‘á»
  - VÃ´ hiá»‡u hÃ³a nÃºt "Continue"

Exc 3: KhÃ´ng Ä‘á»§ sá»‘ dÆ°
â€¢ Táº¡i BÆ°á»›c 3:
  - Pages to print > sá»‘ dÆ° hiá»‡n táº¡i
  - Hiá»ƒn thá»‹ Page Balance Summary mÃ u Ä‘á»
  - Text: "Insufficient balance"
  - Breakdown: "Required: [Y] | Available: [X] | Need: [Y-X] more"
  - VÃ´ hiá»‡u hÃ³a nÃºt "Continue"
  - Hiá»ƒn thá»‹ nÃºt "Buy More Pages"
â€¢ Táº¡i BÆ°á»›c 4 (kiá»ƒm tra láº¡i khi submit):
  - Sá»‘ dÆ° Ä‘Ã£ thay Ä‘á»•i â†’ khÃ´ng Ä‘á»§
  - Há»§y bá» submit (khÃ´ng táº¡o print_job)
  - Hiá»ƒn thá»‹ error modal: "Balance insufficient. Your balance may have changed."
  - Detail: "Required: [Y] | Available: [X]"
  - NÃºt "Back to Settings"

Exc 4: MÃ¡y in khÃ´ng kháº£ dá»¥ng
â€¢ KhÃ´ng cÃ³ mÃ¡y in á»Ÿ vá»‹ trÃ­:
  - Query khÃ´ng tráº£ vá» mÃ¡y in nÃ o
  - Hiá»ƒn thá»‹ empty state: "No printers available at this location."
  - Suggestion: "Try selecting a different location"
  - VÃ´ hiá»‡u hÃ³a nÃºt "Continue"
â€¢ MÃ¡y in offline khi chá»n:
  - KhÃ´ng cho phÃ©p chá»n (card disabled, mÃ u xÃ¡m)
  - Badge "Offline" mÃ u Ä‘á»
  - Tooltip: "This printer is currently offline"
â€¢ MÃ¡y in offline khi submit:
  - MÃ¡y in chuyá»ƒn sang offline hoáº·c is_enabled = 0
  - Há»§y bá» submit (khÃ´ng táº¡o print_job)
  - Hiá»ƒn thá»‹ error modal: "Selected printer is no longer available."
  - NÃºt "Back to Printer Selection"
  - KhÃ´ng trá»« sá»‘ dÆ°
Tiá»n Ä‘iá»u kiá»‡n
â€¢ Sinh viÃªn Ä‘Ã£ Ä‘Äƒng nháº­p (session há»£p lá»‡, student_id cÃ³ trong báº£ng student)
â€¢ CÃ³ Ã­t nháº¥t 1 mÃ¡y in kháº£ dá»¥ng (is_enabled = 1 trong printer_physical)
â€¢ Sinh viÃªn cÃ³ sá»‘ dÆ° > 0
â€¢ Há»‡ thá»‘ng file storage (Supabase) Ä‘ang hoáº¡t Ä‘á»™ng
â€¢ Káº¿t ná»‘i database á»•n Ä‘á»‹nh
â€¢ Print service/queue Ä‘ang hoáº¡t Ä‘á»™ng
Háº­u Ä‘iá»u kiá»‡n
Khi thÃ nh cÃ´ng:
- File Ä‘Æ°á»£c upload vÃ  lÆ°u trong Supabase Storage
- Record má»›i trong báº£ng print_job vá»›i print_status = 'queued'
- Records trong báº£ng print_job_page cho tá»«ng trang cáº§n in
- Giao dá»‹ch Ä‘Æ°á»£c log trong system_audit_log (action_type: 'print_job_created')
- Lá»‡nh in Ä‘Æ°á»£c gá»­i Ä‘áº¿n mÃ¡y in qua print queue
- Sinh viÃªn nháº­n Job ID
- (Background) Printer service cáº­p nháº­t: queued â†’ printing â†’ completed
- (Background) Sá»‘ dÆ° Ä‘Æ°á»£c tÃ­nh real-time tá»« print_job JOIN print_job_page

Khi tháº¥t báº¡i:
- KhÃ´ng táº¡o record nÃ o trong database
- File khÃ´ng Ä‘Æ°á»£c upload hoáº·c bá»‹ xÃ³a
- Sá»‘ dÆ° khÃ´ng thay Ä‘á»•i
- Error Ä‘Æ°á»£c log vÃ o system_audit_log (action_type: 'print_job_failed')
- Sinh viÃªn nháº­n thÃ´ng bÃ¡o lá»—i cá»¥ thá»ƒ
Input
â€¢ File: PDF hoáº·c DOCX (â‰¤50MB)
â€¢ Printer: printer_id tá»« báº£ng printer_physical
â€¢ Print settings:
  - paper_size_id: lookup tá»« page_size (A3/A4/A5)
  - page_range: String (vÃ­ dá»¥: "1-5,8,10-12") hoáº·c "all"
  - page_orientation: 'portrait' hoáº·c 'landscape'
  - print_side: 'one-sided' hoáº·c 'double-sided'
  - color_mode: 'color', 'grayscale', hoáº·c 'black-white'
  - number_of_copy: Integer (1-99)
â€¢ Session data: student_id tá»« authenticated session
Output
ThÃ nh cÃ´ng:
json<br>{<br> "status": "success",<br> "job_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",<br> "printer": {<br> "printer_id": "printer-uuid-here",<br> "name": "HP LaserJet Pro M404dn",<br> "location": "CS1 - H1 - 101"<br> },<br> "file": {<br> "file_name": "Assignment_Final.pdf",<br> "file_size_kb": 2048,<br> "total_pages": 10<br> },<br> "settings": {<br> "paper_size": "A4",<br> "page_range": "1-5,8",<br> "pages_to_print": 6,<br> "orientation": "portrait",<br> "sides": "one-sided",<br> "color_mode": "black-white",<br> "copies": 2<br> },<br> "balance": {<br> "a4_equivalent_to_print": 12,<br> "previous_balance": 150,<br> "remaining_balance": 138<br> },<br> "print_status": "queued",<br> "estimated_completion": "2024-12-04T10:35:00Z",<br> "created_at": "2024-12-04T10:30:00Z"<br>}<br>

Tháº¥t báº¡i - KhÃ´ng Ä‘á»§ sá»‘ dÆ°:
json<br>{<br> "status": "error",<br> "error_code": "INSUFFICIENT_BALANCE",<br> "message": "KhÃ´ng Ä‘á»§ sá»‘ dÆ°. Vui lÃ²ng mua thÃªm trang.",<br> "details": {<br> "required_pages": 20,<br> "current_balance": 15,<br> "shortage": 5<br> },<br> "suggestion": "Buy 50 pages package for $10.00 to continue"<br>}<br>

Tháº¥t báº¡i - MÃ¡y in offline:
json<br>{<br> "status": "error",<br> "error_code": "PRINTER_OFFLINE",<br> "message": "MÃ¡y in Ä‘Ã£ chá»n khÃ´ng kháº£ dá»¥ng.",<br> "details": {<br> "printer_id": "printer-uuid-here",<br> "printer_name": "HP LaserJet Pro M404dn",<br> "location": "CS1 - H1 - 101",<br> "current_status": "offline"<br> },<br> "suggestion": "Please select another printer"<br>}<br>

Tháº¥t báº¡i - File khÃ´ng há»£p lá»‡:
json<br>{<br> "status": "error",<br> "error_code": "INVALID_FILE",<br> "message": "File khÃ´ng há»£p lá»‡.",<br> "details": {<br> "file_name": "document.exe",<br> "file_size_kb": 1024,<br> "reason": "Invalid file type. Only PDF and DOCX are allowed."<br> }<br>}<br>

Tháº¥t báº¡i - Lá»—i káº¿t ná»‘i:
json<br>{<br> "status": "error",<br> "error_code": "NETWORK_ERROR",<br> "message": "Káº¿t ná»‘i tháº¥t báº¡i. Vui lÃ²ng thá»­ láº¡i.",<br> "details": {<br> "error": "Connection timeout",<br> "timestamp": "2024-12-04T10:30:15Z"<br> }<br>}<br>


Technical Notes

File Storage:
â€¢ Files táº£i lÃªn Supabase Storage bucket: print-documents
â€¢ File naming: {student_id}/{timestamp}_{original_filename}
â€¢ Chá»‰ file_name (khÃ´ng cÃ³ URL prefix) Ä‘Æ°á»£c lÆ°u trong print_job.file_name
â€¢ Backend thÃªm Supabase URL khi truy xuáº¥t
â€¢ Scheduled cleanup: xÃ³a files > 30 ngÃ y sau print_status = 'completed'

Page Balanc:
â€¢ Balance KHÃ”NG Ä‘Æ°á»£c lÆ°u trá»±c tiáº¿p - tÃ­nh real-time khi cáº§n
â€¢ Total purchased: SUM tá»« student_page_purchase WHERE payment_status = 'completed', chuyá»ƒn Ä‘á»•i sang A4 equivalent sá»­ dá»¥ng tá»· lá»‡ chuyá»ƒn Ä‘á»•i page_size
â€¢ Total printed: SUM tá»« print_job JOIN print_job_page WHERE print_status = 'completed', chuyá»ƒn Ä‘á»•i sang A4 equivalent
â€¢ Balance = Total purchased - Total printed

Page Range Parsing:
â€¢ Input: "1-5, 8, 10-12"
â€¢ Backend tÃ¡ch báº±ng dáº¥u pháº©y, má»Ÿ rá»™ng ranges, loáº¡i bá» trÃ¹ng láº·p
â€¢ Kiá»ƒm tra táº¥t cáº£ page numbers â‰¤ document total pages
â€¢ Táº¡o cÃ¡c record riÃªng láº» trong print_job_page cho má»—i trang

Print Status Workflow:
â€¢ NgÆ°á»i dÃ¹ng submit â†’ print_status = 'queued', start_time = NULL, end_time = NULL
â€¢ Printer nháº­n â†’ print_status = 'printing', start_time = GETDATE()
â€¢ HoÃ n thÃ nh â†’ print_status = 'completed', end_time = GETDATE()
â€¢ Tháº¥t báº¡i â†’ print_status = 'failed', end_time = GETDATE() (balance khÃ´ng bá»‹ trá»«)
â€¢ NgÆ°á»i dÃ¹ng há»§y â†’ print_status = 'cancelled' (chá»‰ khi cÃ²n 'queued')

Error Logging:
â€¢ Táº¥t cáº£ errors Ä‘Æ°á»£c log vÃ o system_audit_log vá»›i action_type = 'print_job_failed' hoáº·c 'print_job_created'


ThÃ nh viÃªn
Äá»“ng Ã½
KhÃ´ng Ä‘á»“ng Ã½
LÃª Ngá»c ÄÄƒng Khoa




Hiá»ƒu Vy LÃ½




Nguyá»…n Há»“ng Báº£o Ngá»c




LÃª Anh Tuáº¥n




Phan Thanh ThÃ¡i Tuáº¥n




Phan Äiá»n Máº¡nh ThiÃªn






