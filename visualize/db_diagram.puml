@startuml
!theme plain
top to bottom direction
skinparam classAttributeIconSize 0
skinparam linetype ortho

skinparam class {
  BackgroundColor LightBlue
  BorderColor Blue
}

' Level 0 tables
class deposit {
  deposit_id
  student_id
  deposit_amount
  bonus_amount
  total_credited
  deposit_bonus_package_id
  payment_method
  payment_reference
  payment_status
  transaction_date
}
class fund_source {
  fund_id
  fund_source_type
  fund_source_name
  amount
  received_date
  description
  created_at
  created_by
}
class paper_purchase_item {
  purchase_item_id
  purchase_id
  page_size_id
  quantity
  unit_price
  total_price
  received_quantity
  received_date
  notes
  CHECK
}
class password_reset_token {
  token_id
  token
  user_id
  expiry_date
  used
  created_at
}
class payment {
  payment_id
  job_id
  student_id
  amount_paid_directly
  amount_paid_from_balance
  total_amount
  payment_method
  payment_reference
  payment_status
  transaction_date
  CHECK
}
class permitted_file_type {
  file_type_id
  file_extension
  mime_type
  description
  is_permitted
  created_at
  updated_at
  updated_by
}
class print_job_page {
  page_record_id
  job_id
  page_number
  UNIQUE
}
class printer_log {
  log_id
  printer_id
  log_type
  severity
  description
  job_id
  user_id
  details
  error_code
  is_resolved
  resolved_at
  resolved_by
  resolution_notes
  ip_address
  created_at
}
class refresh_token {
  token_id
  token
  user_id
  expiry_date
  created_at
  revoked
}
class student_semester_bonus {
  student_bonus_id
  student_id
  semester_bonus_id
  semester_id
  received
  received_date
  created_at
  UNIQUE
}
class system_audit_log {
  audit_id
  user_id
  action_type
  table_name
  record_id
  previous_audit_id
  changed_field
  ip_address
  user_agent
  action_timestamp
}
class system_configuration {
  config_id
  config_key
  config_value
  description
  updated_at
  updated_by
}

' Level 1 tables
class deposit_bonus_package {
  package_id
  amount_cap
  bonus_percentage
  package_name
  description
  is_active
  created_at
  updated_at
}
class print_job {
  job_id
  student_id
  printer_id
  file_url
  file_type
  file_size_kb
  page_size_price_id
  color_mode_price_id
  page_discount_package_id
  page_orientation
  print_side
  number_of_copy
  total_pages
  subtotal_before_discount
  discount_percentage
  discount_amount
  total_price
  print_status
  start_time
  end_time
  created_at
}
class semester_bonus {
  bonus_id
  semester_id
  bonus_amount
  description
  created_at
  created_by
  UNIQUE
}
class supplier_paper_purchase {
  purchase_id
  supplier_name
  supplier_contact
  purchase_date
  total_amount_paid
  payment_method
  payment_reference
  payment_status
  invoice_number
  notes
  created_at
  created_by
}

' Level 2 tables
class color_mode_price {
  setting_id
  color_mode_id
  price_per_page
  is_active
  created_at
  updated_at
}
class page_discount_package {
  package_id
  min_pages
  discount_percentage
  package_name
  description
  is_active
  created_at
  updated_at
}
class page_size_price {
  price_id
  page_size_id
  page_price
  is_active
  created_at
  updated_at
}
class printer_physical {
  printer_id
  model_id
  room_id
  serial_number
  printer_pixel_coordinate
  is_enabled
  status
  printing_status
  installed_date
  last_maintenance_date
  created_at
  updated_at
  created_by
}
class semester {
  semester_id
  academic_year_id
  term_name
  start_date
  end_date
  created_at
  UNIQUE
}
class student {
  student_id
  user_id
  student_code
  class_id
  enrollment_date
  graduation_date
  status
}

' Level 3 tables
class "class" {
  class_id
  major_id
  academic_year_id
  class_name
  class_code
  year_level
  max_students
  created_at
  UNIQUE
}
class color_mode {
  color_mode_id
  color_mode_name
  description
  created_at
}
class printer_model {
  model_id
  brand_id
  model_name
  description
  max_paper_size_id
  supports_color
  supports_duplex
  pages_per_second
  image_2d_url
  image_3d_url
  created_at
  UNIQUE
}
class room {
  room_id
  floor_id
  room_code
  room_name
  room_type
  created_at
  UNIQUE
}
class staff {
  staff_id
  user_id
  employee_code
  position
  hire_date
}

' Level 4 tables
class academic_year {
  academic_year_id
  year_name
  start_date
  end_date
  is_current
  created_at
}
class brand {
  brand_id
  brand_name
  country_of_origin
  website
  created_at
}
class floor {
  floor_id
  building_id
  floor_number
  file_url
  created_at
  UNIQUE
}
class major {
  major_id
  department_id
  major_name
  major_code
  degree_type
  duration_years
  description
  established_date
  created_at
  UNIQUE
}
class page_size {
  page_size_id
  size_name
  width_mm
  height_mm
  created_at
}
class "user" {
  user_id
  email
  full_name
  password_hash
  user_type
  phone_number
  date_of_birth
  gender
  citizen_id
  address
  profile_picture
  email_verified
  email_verification_code
  account_status
  created_at
  updated_at
  last_login_at
  is_active
}

' Level 5 tables
class building {
  building_id
  building_code
  address
  campus_name
  created_at
}
class department {
  department_id
  faculty_id
  department_name
  department_code
  description
  established_date
  created_at
  UNIQUE
}

' Level 6 tables
class faculty {
  faculty_id
  faculty_name
  faculty_code
  description
  established_date
  created_at
}

' Relationships
faculty <-- department
department <-- major
major <-- "class"
academic_year <-- "class"
"user" <-- student
"class" <-- student
"user" <-- staff
building <-- floor
floor <-- room
brand <-- printer_model
page_size <-- printer_model
printer_model <-- printer_physical
room <-- printer_physical
staff <-- printer_physical
academic_year <-- semester
student <-- deposit
deposit_bonus_package <-- deposit
semester <-- semester_bonus
staff <-- semester_bonus
student <-- student_semester_bonus
semester_bonus <-- student_semester_bonus
semester <-- student_semester_bonus
color_mode <-- color_mode_price
page_size <-- page_size_price
staff <-- fund_source
staff <-- supplier_paper_purchase
supplier_paper_purchase <-- paper_purchase_item
page_size <-- paper_purchase_item
staff <-- system_configuration
staff <-- permitted_file_type
student <-- print_job
printer_physical <-- print_job
page_size_price <-- print_job
color_mode_price <-- print_job
page_discount_package <-- print_job
print_job <-- print_job_page
print_job <-- payment
student <-- payment
printer_physical <-- printer_log
print_job <-- printer_log
"user" <-- printer_log
"user" <-- system_audit_log
"user" <-- refresh_token
"user" <-- password_reset_token
@enduml