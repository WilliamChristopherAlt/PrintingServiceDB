# THIẾT KẾ KIẾN TRÚC HỆ THỐNG HCMSIU-SSPS

## SƠ ĐỒ KIẾN TRÚC TỔNG THỂ

Hệ thống HCMSIU-SSPS (HCMIU Student Smart Printing Service) được thiết kế theo kiến trúc phân tầng (Layered Architecture) với bốn tầng chính: Presentation Layer (Tầng Giao Diện), API Gateway Layer (Tầng Cổng API), Business Logic Layer (Tầng Logic Nghiệp Vụ), và Data Access Layer (Tầng Truy Cập Dữ Liệu). Kiến trúc này tách biệt rõ ràng các mối quan tâm, cho phép phát triển, bảo trì và mở rộng từng tầng độc lập. Tầng Presentation chứa ứng dụng Next.js frontend cung cấp giao diện người dùng cho sinh viên và nhân viên. Tầng API Gateway đóng vai trò là điểm vào duy nhất, xử lý xác thực, định tuyến yêu cầu, và quản lý WebSocket connections. Tầng Business Logic chứa các service xử lý logic nghiệp vụ như quản lý in ấn, thanh toán, nạp tiền, và tính toán giá. Tầng Data Access sử dụng JPA/Hibernate để truy cập cơ sở dữ liệu Azure SQL Server. Hệ thống cũng tích hợp với các dịch vụ bên ngoài như Supabase Storage cho lưu trữ file, Payment Gateway (SePay) cho thanh toán, và máy in vật lý thông qua Printer Controller.

## CHIẾN LƯỢC TRÌNH BÀY GIAO DIỆN NGƯỜI DÙNG

Hệ thống sử dụng Next.js 14 với React 18 và TypeScript để xây dựng giao diện người dùng theo mô hình Server-Side Rendering (SSR) và Static Site Generation (SSG) để tối ưu hiệu suất và SEO. Giao diện được tổ chức thành hai phần chính: phần dành cho sinh viên và phần dành cho nhân viên quản trị, mỗi phần có các trang chức năng riêng biệt. Sinh viên có thể truy cập các trang như dashboard, in tài liệu, lịch sử in, nạp tiền, và quản lý hồ sơ. Nhân viên có thể truy cập các trang quản lý máy in, quản lý sinh viên, báo cáo, và cấu hình hệ thống. Hệ thống sử dụng Tailwind CSS cho styling, đảm bảo giao diện responsive và hiện đại. State management được xử lý bằng Zustand cho global state và React Query (TanStack Query) cho server state management, giúp quản lý cache và synchronization với backend hiệu quả. WebSocket được tích hợp để cung cấp real-time updates cho tiến trình in, thông báo, và trạng thái thanh toán. Giao diện hỗ trợ đa ngôn ngữ (i18n) thông qua next-intl, cho phép chuyển đổi giữa tiếng Việt và tiếng Anh. Form validation được thực hiện bằng React Hook Form kết hợp với Zod schema validation, đảm bảo dữ liệu đầu vào hợp lệ trước khi gửi đến backend. Tham khảo: [Next.js Documentation](https://nextjs.org/docs), [React Query Documentation](https://tanstack.com/query/latest), [Tailwind CSS Documentation](https://tailwindcss.com/docs).

## CHIẾN LƯỢC LƯU TRỮ DỮ LIỆU

Hệ thống sử dụng Azure SQL Server làm cơ sở dữ liệu quan hệ chính để lưu trữ tất cả dữ liệu nghiệp vụ bao gồm thông tin người dùng, công việc in, thanh toán, nạp tiền, và sổ cái tài chính. Azure SQL Server được chọn vì khả năng đảm bảo ACID compliance, hỗ trợ transactions phức tạp, và tích hợp tốt với hệ sinh thái Microsoft Azure. Dữ liệu được tổ chức theo mô hình quan hệ chuẩn hóa với các bảng được liên kết thông qua foreign keys để đảm bảo tính toàn vẹn dữ liệu. Hệ thống sử dụng Spring Data JPA với Hibernate làm ORM framework để ánh xạ các entity Java sang các bảng trong database, giảm thiểu việc viết SQL thủ công và tăng tính bảo trì của code. JPA Repository pattern được sử dụng để truy cập dữ liệu, cho phép dễ dàng thêm các custom queries khi cần thiết. Để tối ưu hiệu suất, hệ thống sử dụng database indexing trên các cột thường xuyên được truy vấn như foreign keys, trạng thái, và ngày tháng. Connection pooling được cấu hình thông qua HikariCP để quản lý hiệu quả các kết nối database. File uploads (tài liệu cần in) được lưu trữ trên Supabase Storage thay vì database để tối ưu hiệu suất và chi phí, Supabase Storage cung cấp CDN distribution tự động và khả năng scale tốt. Backup và disaster recovery được xử lý bởi Azure SQL Server với tính năng automated backups và point-in-time restore. Tham khảo: [Azure SQL Database Documentation](https://learn.microsoft.com/en-us/azure/azure-sql/database/), [Spring Data JPA Documentation](https://spring.io/projects/spring-data-jpa), [Supabase Storage Documentation](https://supabase.com/docs/guides/storage).

## QUẢN LÝ TRUY CẬP API VÀ DỊCH VỤ BÊN NGOÀI

Hệ thống quản lý truy cập đến các dịch vụ bên ngoài thông qua một lớp abstraction và integration pattern để đảm bảo tính linh hoạt và dễ bảo trì. Payment Gateway (SePay) được tích hợp thông qua REST API và webhook mechanism: khi sinh viên yêu cầu nạp tiền, hệ thống gọi API của SePay để tạo mã QR thanh toán, sau đó SePay gửi webhook về hệ thống khi thanh toán thành công. Webhook được xác thực bằng chữ ký số để đảm bảo tính bảo mật và tính toàn vẹn của dữ liệu. Supabase Storage được tích hợp thông qua Supabase Java Client để upload và download files, với retry mechanism và error handling để xử lý các lỗi network. Email service sử dụng Gmail SMTP thông qua Spring Mail để gửi email xác thực, đặt lại mật khẩu, và thông báo. Printer hardware được điều khiển thông qua Printer Controller component, component này giao tiếp với máy in vật lý thông qua network protocol (có thể là IPP, SNMP, hoặc custom protocol tùy theo loại máy in). Tất cả các integration với external services đều được wrap trong service classes với interface abstraction, cho phép dễ dàng thay thế implementation hoặc thêm mock cho testing. Circuit breaker pattern có thể được áp dụng để xử lý các lỗi từ external services và tránh cascade failures. API rate limiting được áp dụng ở tầng API Gateway để bảo vệ backend khỏi quá tải. CORS được cấu hình để chỉ cho phép frontend domain truy cập API. Tất cả các API endpoints đều yêu cầu JWT authentication trừ các endpoint công khai như đăng nhập và đăng ký. Tham khảo: [Spring Integration Documentation](https://spring.io/projects/spring-integration), [Webhook Best Practices](https://webhooks.fyi/), [API Gateway Pattern](https://microservices.io/patterns/apigateway.html).

